var be=Object.defineProperty;var we=(t,e,r)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Q=(t,e,r)=>we(t,typeof e!="symbol"?e+"":e,r);import{t as x,a as E,c as Ee,d as G}from"../chunks/CHeTuHCu.js";import{s as W,h as S,J as Ae,I as Te,i as ke,b as Le,w as m,v as Se,j as xe,r as ne,k as $,c as z,ab as Ie,m as fe,a as de,p as Ce,af as ve,a5 as Ne,A as Pe,an as oe,ao as ee,M as ie,ap as qe,aq as Me,ar as Ke,ae as Oe,as as Re,d as De,at as Ue,au as He,a9 as Ye,av as Fe,aw as Be,ax as ze,ay as Ve,az as je,aA as Ge,g as Je,ai as Xe,X as Y,Y as O,Z as F,_ as L,$ as k,f as me,a0 as N,aB as J,z as p,ak as U,am as j,y as le,al as Ze}from"../chunks/C9IIAIDx.js";import{p as w,i as X}from"../chunks/BGiG_neq.js";import{a as Qe,l as We,d as $e,s as H,e as he}from"../chunks/C7f5l9cp.js";import{s as et}from"../chunks/I43rO1gR.js";function tt(t,e,r,a){for(var s=[],o=e.length,n=0;n<o;n++)Ke(e[n].e,s,!0);var i=o>0&&s.length===0&&r!==null;if(i){var u=r.parentNode;Oe(u),u.append(r),a.clear(),M(t,e[0].prev,e[o-1].next)}Re(s,()=>{for(var c=0;c<o;c++){var l=e[c];i||(a.delete(l.k),M(t,l.prev,l.next)),De(l.e,!i)}})}function rt(t,e,r,a,s,o=null){var n=t,i={flags:e,items:new Map,first:null};{var u=t;n=S?W(Ae(u)):u.appendChild(Te())}S&&ke();var c=null,l=!1,v=Se(()=>{var f=r();return Ne(f)?f:f==null?[]:ve(f)});Le(()=>{var f=m(v),y=f.length;if(l&&y===0)return;l=y===0;let _=!1;if(S){var A=n.data===xe;A!==(y===0)&&(n=ne(),W(n),$(!1),_=!0)}if(S){for(var I=null,g,T=0;T<y;T++){if(z.nodeType===8&&z.data===Ie){n=z,_=!0,$(!1);break}var d=f[T],h=a(d,T);g=_e(z,i,I,null,d,h,T,s,e,r),i.items.set(h,g),I=g}y>0&&W(ne())}S||at(f,i,n,s,e,a,r),o!==null&&(y===0?c?fe(c):c=de(()=>o(n)):c!==null&&Ce(c,()=>{c=null})),_&&$(!0),m(v)}),S&&(n=z)}function at(t,e,r,a,s,o,n){var i=t.length,u=e.items,c=e.first,l=c,v,f=null,y=[],_=[],A,I,g,T;for(T=0;T<i;T+=1){if(A=t[T],I=o(A,T),g=u.get(I),g===void 0){var d=l?l.e.nodes_start:r;f=_e(d,e,f,f===null?e.first:f.next,A,I,T,a,s,n),u.set(I,f),y=[],_=[],l=f.next;continue}if(st(g,A,T),(g.e.f&ee)!==0&&fe(g.e),g!==l){if(v!==void 0&&v.has(g)){if(y.length<_.length){var h=_[0],b;f=h.prev;var P=y[0],C=y[y.length-1];for(b=0;b<y.length;b+=1)ue(y[b],h,r);for(b=0;b<_.length;b+=1)v.delete(_[b]);M(e,P.prev,C.next),M(e,f,P),M(e,C,h),l=h,f=C,T-=1,y=[],_=[]}else v.delete(g),ue(g,l,r),M(e,g.prev,g.next),M(e,g,f===null?e.first:f.next),M(e,f,g),f=g;continue}for(y=[],_=[];l!==null&&l.k!==I;)(l.e.f&ee)===0&&(v??(v=new Set)).add(l),_.push(l),l=l.next;if(l===null)continue;g=l}y.push(g),f=g,l=g.next}if(l!==null||v!==void 0){for(var q=v===void 0?[]:ve(v);l!==null;)(l.e.f&ee)===0&&q.push(l),l=l.next;var B=q.length;if(B>0){var V=i===0?r:null;tt(e,q,V,u)}}ie.first=e.first&&e.first.e,ie.last=f&&f.e}function st(t,e,r,a){Me(t.v,e),t.i=r}function _e(t,e,r,a,s,o,n,i,u,c){var l=(u&Ue)!==0,v=(u&He)===0,f=l?v?Pe(s):oe(s):s,y=(u&qe)===0?n:oe(n),_={i:y,v:f,k:o,a:null,e:null,prev:r,next:a};try{return _.e=de(()=>i(t,f,y,c),S),_.e.prev=r&&r.e,_.e.next=a&&a.e,r===null?e.first=_:(r.next=_,r.e.next=_.e),a!==null&&(a.prev=_,a.e.prev=_.e),_}finally{}}function ue(t,e,r){for(var a=t.next?t.next.e.nodes_start:r,s=e?e.e.nodes_start:r,o=t.e.nodes_start;o!==a;){var n=Ye(o);s.before(o),o=n}}function M(t,e,r){e===null?t.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}function nt(t,e,r){var a=t==null?"":""+t;return e&&(a=a?a+" "+e:e),a===""?null:a}function ae(t,e,r,a,s,o){var n=t.__className;if(S||n!==r||n===void 0){var i=nt(r,a);(!S||i!==t.getAttribute("class"))&&(i==null?t.removeAttribute("class"):t.className=i),t.__className=r}return o}const ot=Symbol("is custom element"),it=Symbol("is html");function lt(t){if(S){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var a=t.value;K(t,"value",null),t.value=a}if(t.hasAttribute("checked")){var s=t.checked;K(t,"checked",null),t.checked=s}}};t.__on_r=r,Fe(r),Qe()}}function K(t,e,r,a){var s=ut(t);S&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=r)&&(e==="loading"&&(t[Be]=r),r==null?t.removeAttribute(e):typeof r!="string"&&ct(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function ut(t){return t.__attributes??(t.__attributes={[ot]:t.nodeName.includes("-"),[it]:t.namespaceURI===ze})}var ce=new Map;function ct(t){var e=ce.get(t.nodeName);if(e)return e;ce.set(t.nodeName,e=[]);for(var r,a=t,s=Element.prototype;s!==a;){r=je(a);for(var o in r)r[o].set&&e.push(o);a=Ve(a)}return e}function ft(t,e,r=e){var a=Ge();We(t,"input",s=>{var o=s?t.defaultValue:t.value;if(o=te(t)?re(o):o,r(o),a&&o!==(o=e())){var n=t.selectionStart,i=t.selectionEnd;t.value=o??"",i!==null&&(t.selectionStart=n,t.selectionEnd=Math.min(i,t.value.length))}}),(S&&t.defaultValue!==t.value||Je(e)==null&&t.value)&&r(te(t)?re(t.value):t.value),Xe(()=>{var s=e();te(t)&&s===re(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function te(t){var e=t.type;return e==="number"||e==="range"}function re(t){return t===""?null:+t}const R={set:(t,e)=>new Promise((r,a)=>{chrome.storage.local.set(t,()=>{if(chrome.runtime.lastError)return a(chrome.runtime.lastError);r(),e==null||e()})}),get:(t,e)=>new Promise((r,a)=>{chrome.storage.local.get(t,s=>{if(chrome.runtime.lastError)return a(chrome.runtime.lastError);if(s[t])r(s[t]);else return a("No items found");e==null||e(s)})}),getAll:t=>new Promise(e=>{chrome.storage.local.get(null,r=>{t==null||t(r),e(r)})}),remove:(t,e)=>new Promise((r,a)=>{chrome.storage.local.remove(t,()=>{if(chrome.runtime.lastError)return a(chrome.runtime.lastError);r(),e==null||e()})}),clear:t=>new Promise((e,r)=>{chrome.storage.local.clear(()=>{if(chrome.runtime.lastError)return r(chrome.runtime.lastError);e(),t==null||t()})}),getBytesInUse:t=>new Promise((e,r)=>{chrome.storage.local.getBytesInUse(t,a=>{if(chrome.runtime.lastError)return r(chrome.runtime.lastError);e(a)})}),listen:t=>{chrome.storage.onChanged.addListener((e,r)=>{r==="local"&&t(e,r)})}},D={API_KEY:"apiKey",LIST_TOKEN:"listToken",LIST_SYMBOL:"listSymbol",CACHE_TOKEN_:"cacheToken_"},dt=1e3*30;class vt{constructor(e={}){Q(this,"baseURL");Q(this,"headers");this.baseURL=e.baseURL||"",this.headers=e.headers||{"Content-Type":"application/json"}}buildURL(e,r){const a=`${this.baseURL}${e}`;if(!r)return a;const s=new URLSearchParams(r).toString();return s?`${a}?${s}`:a}async request(e,r,a={}){const{params:s,headers:o,body:n,...i}=a,u=this.buildURL(r,s),c={...this.headers,...o},l=await fetch(u,{method:e,headers:c,body:n?JSON.stringify(n):void 0,...i}),v=l.headers.get("Content-Type");if(!l.ok){const f=v!=null&&v.includes("application/json")?await l.json():await l.text();throw new Error(`HTTP error! status: ${l.status} ${l.statusText}. ${JSON.stringify(f)}`)}return v!=null&&v.includes("application/json")?await l.json():await l.text()}get(e,r){return this.request("GET",e,r)}post(e,r,a){return this.request("POST",e,{...a,body:r})}put(e,r,a){return this.request("PUT",e,{...a,body:r})}delete(e,r){return this.request("DELETE",e,r)}}const mt=new vt({baseURL:"https://pro-api.coinmarketcap.com/v1",headers:{"Content-Type":"application/json"}}),ge=async()=>{const t=await R.get(D.API_KEY);if(!t)throw new Error("No API key found");return t},ht=async t=>{const e=await ge();return console.log({apiKey:e}),await mt.get("/cryptocurrency/quotes/latest",{params:{symbol:t},headers:{"X-CMC_PRO_API_KEY":e}})},_t=t=>`https://s2.coinmarketcap.com/static/img/coins/64x64/${t}.png`,gt=t=>`https://coinmarketcap.com/currencies/${t==null?void 0:t.slug}/`;function yt(t,{currencySymbol:e="",decimalSeparator:r=".",thousandSeparator:a=","}={}){if(typeof t!="number"||isNaN(t))return"";const s=Math.abs(t),o=t<0?"-":"";let n;s>=1e6?n=2:s>0&&s<1?n=4:n=2;const i=s.toFixed(n),[u,c]=i.split("."),l=u.replace(/\B(?=(\d{3})+(?!\d))/g,a),v=c?l+r+c:l;return`${o}${e}${v}`}function pt(t){const e=/^[a-fA-F0-9]{32}$/,r=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;return e.test(t)||r.test(t)}var bt=x("<input>");function ye(t,e){Y(e,!0);let r=w(e,"value",15),a=w(e,"placeholder",3,""),s=w(e,"type",3,"text"),o=w(e,"required",3,!1),n=w(e,"disabled",3,!1),i=w(e,"class",3,"");var u=bt();lt(u),O(()=>{K(u,"placeholder",a()),K(u,"type",s()),u.required=o(),u.disabled=n(),ae(u,1,`base-input ${i()}`,"svelte-cibltr")}),ft(u,r),E(t,u),F()}const wt=(t,e,r)=>{!e()&&r.onclick&&r.onclick()};var Et=x("<button><!></button>");function Z(t,e){Y(e,!0);let r=w(e,"type",3,"button"),a=w(e,"variant",3,"primary"),s=w(e,"size",3,"medium"),o=w(e,"disabled",3,!1),n=w(e,"class",3,"");var i=Et();i.__click=[wt,o,e];var u=L(i);et(u,()=>e.children),k(i),O(()=>{K(i,"type",r()),i.disabled=o(),ae(i,1,`base-button base-button--${a()} base-button--${s()} ${n()}`,"svelte-1fscj27")}),E(t,i),F()}$e(["click"]);var At=x("<div> </div>");function pe(t,e){let r=w(e,"type",3,"error"),a=w(e,"show",3,!0);var s=Ee(),o=me(s);{var n=i=>{var u=At(),c=L(u,!0);k(u),O(()=>{ae(u,1,`notification notification--${r()}`,"svelte-16puni2"),H(c,e.message)}),E(i,u)};X(o,i=>{a()&&e.message&&i(n)})}E(t,s)}var Tt=x('<div class="header-container svelte-111vmjl"><a href="https://coinmarketcap.com/" target="_blank" class="header-link svelte-111vmjl"><h1 class="header-title svelte-111vmjl"> </h1></a> <!></div>');function kt(t,e){let r=w(e,"showLogout",3,!1);var a=Tt(),s=L(a),o=L(s),n=L(o,!0);k(o),k(s);var i=N(s,2);{var u=c=>{Z(c,{variant:"secondary",size:"small",class:"logout-btn",get onclick(){return e.onLogout},children:(l,v)=>{J();var f=G("Ã—");E(l,f)},$$slots:{default:!0}})};X(i,c=>{r()&&e.onLogout&&c(u)})}k(a),O(()=>H(n,e.title)),E(t,a)}var Lt=x('<form class="api-key-form svelte-11sux8a"><a href="https://coinmarketcap.com/" target="_blank" class="form-title-link svelte-11sux8a"><h2 class="form-title svelte-11sux8a"> </h2></a> <!> <!> <!></form>');function St(t,e){Y(e,!0);let r=w(e,"error",3,""),a=w(e,"isLoading",3,!1),s=U("");const o=async A=>{A.preventDefault(),m(s).trim()&&!a()&&(await e.onSubmit(m(s).trim()),p(s,""))};var n=Lt(),i=L(n),u=L(i),c=L(u,!0);k(u),k(i);var l=N(i,2);ye(l,{placeholder:"Enter your Coinmarketcap API Key",required:!0,get disabled(){return a()},get value(){return m(s)},set value(A){p(s,A,!0)}});var v=N(l,2);const f=j(()=>!!r());pe(v,{get message(){return r()},get show(){return m(f)}});var y=N(v,2);const _=j(()=>!m(s).trim()||a());Z(y,{type:"submit",get disabled(){return m(_)},class:"submit-btn",children:(A,I)=>{J();var g=G();O(()=>H(g,a()?"Adding...":"Add Coinmarketcap API Key")),E(A,g)},$$slots:{default:!0}}),k(n),O(()=>H(c,e.title)),he("submit",n,o),E(t,n),F()}var xt=x('<form class="symbol-form svelte-1xe1foj"><!> <!></form>');function It(t,e){Y(e,!0);let r=w(e,"isLoading",3,!1),a=U("");const s=async c=>{c.preventDefault(),m(a).trim()&&!r()&&(await e.onSubmit(m(a).trim().toUpperCase()),p(a,""))};var o=xt(),n=L(o);ye(n,{placeholder:"Enter a crypto symbol",required:!0,get disabled(){return r()},class:"symbol-input",get value(){return m(a)},set value(c){p(a,c,!0)}});var i=N(n,2);const u=j(()=>!m(a).trim()||r());Z(i,{type:"submit",get disabled(){return m(u)},class:"add-btn",children:(c,l)=>{J();var v=G();O(()=>H(v,r()?"Adding...":"Add")),E(c,v)},$$slots:{default:!0}}),k(o),he("submit",o,s),E(t,o),F()}var Ct=x('<li class="crypto-item svelte-uqyly6"><a target="_blank" class="crypto-item-content svelte-uqyly6"><img class="crypto-icon svelte-uqyly6"> <h3 class="crypto-symbol svelte-uqyly6"> </h3> <p class="crypto-price svelte-uqyly6"> </p></a> <!></li>');function Nt(t,e){Y(e,!0);const r=()=>{e.onDelete(e.token.symbol)};var a=Ct(),s=L(a),o=L(s),n=N(o,2),i=L(n,!0);k(n);var u=N(n,2),c=L(u);k(u),k(s);var l=N(s,2);Z(l,{variant:"danger",size:"small",class:"delete-btn",onclick:r,children:(v,f)=>{J();var y=G("Ã—");E(v,y)},$$slots:{default:!0}}),k(a),O((v,f)=>{K(s,"href",v),K(o,"src",e.token.img),K(o,"alt",e.token.symbol),H(i,e.token.symbol),H(c,`$${f??""}`)},[()=>gt(e.token),()=>yt(e.token.price)]),E(t,a),F()}var Pt=x('<div class="empty-state svelte-g5sqs7">No cryptocurrencies added yet. Add your first one above!</div>'),qt=x('<ul class="crypto-list svelte-g5sqs7"></ul>'),Mt=x('<div class="crypto-list-container svelte-g5sqs7"><!></div>');function Kt(t,e){Y(e,!0);var r=Mt(),a=L(r);{var s=n=>{var i=Pt();E(n,i)},o=n=>{var i=qt();rt(i,21,()=>e.tokens,u=>u.symbol,(u,c)=>{Nt(u,{get token(){return m(c)},get onDelete(){return e.onDeleteToken}})}),k(i),E(n,i)};X(a,n=>{e.tokens.length===0?n(s):n(o,!1)})}k(r),E(t,r),F()}var Ot=x("<!> <!> <!> <!>",1),Rt=x('<div class="container svelte-zg3uhh"><!></div>');function zt(t,e){Y(e,!0);let r=U(!0),a=U(le([])),s=U(le([])),o=U(""),n=U(!1);Ze().then(async()=>{let d="";try{d=await ge(),p(r,!!d)}catch(h){console.log("debug",h),p(r,!1)}m(r)&&await _()});const i=async d=>{var B,V,se;const h=await ht(d);if(!h)return;const b=(B=h.data)==null?void 0:B[d].quote.USD.price,P=(V=h.data)==null?void 0:V[d].id,C=_t(P.toString()),q={price:b,symbol:d,img:C,slug:(se=h.data)==null?void 0:se[d].slug};p(a,[...m(a),q],!0),c(d,q)},u=async()=>{await R.set({[D.LIST_SYMBOL]:m(s)})},c=async(d,h)=>{const b=Date.now()+dt;await R.set({[`${D.CACHE_TOKEN_}${d}`]:{token:h,expireTime:b}})},l=async d=>{p(o,""),p(n,!0);try{p(s,[...m(s),d],!0),await i(d),await u()}catch{p(o,"Invalid symbol"),p(s,m(s).filter(b=>b!==d),!0)}finally{p(n,!1)}},v=async d=>{p(o,""),p(n,!0);try{pt(d)?(await R.set({[D.API_KEY]:d}),p(r,!0),await _()):p(o,"Invalid API key")}catch{p(o,"Failed to save API key")}finally{p(n,!1)}},f=d=>{p(s,m(s).filter(h=>h!==d),!0),p(a,m(a).filter(h=>h.symbol!==d),!0),u()},y=async()=>{await R.set({[D.API_KEY]:""}),p(r,!1),p(a,[],!0),p(s,[],!0)},_=async()=>{try{const d=await R.get(D.LIST_SYMBOL);p(s,Object.values(d),!0),await Promise.all(m(s).map(async h=>{const b=`${D.CACHE_TOKEN_}${h}`,{token:P,expireTime:C}=await R.get(b);P&&C?C<Date.now()?await i(h):m(a).push(P):await i(h)}))}catch(d){console.log("error when fetch list token: ",d)}};var A=Rt(),I=L(A);{var g=d=>{St(d,{title:"Coinmarketcap Tracker",onSubmit:v,get error(){return m(o)},get isLoading(){return m(n)}})},T=d=>{var h=Ot(),b=me(h);kt(b,{title:"Coinmarketcap",onLogout:y,showLogout:!0});var P=N(b,2);It(P,{onSubmit:l,get isLoading(){return m(n)}});var C=N(P,2);const q=j(()=>!!m(o));pe(C,{get message(){return m(o)},get show(){return m(q)}});var B=N(C,2);Kt(B,{get tokens(){return m(a)},onDeleteToken:f}),E(d,h)};X(I,d=>{m(r)?d(T,!1):d(g)})}k(A),E(t,A),F()}export{zt as component};
